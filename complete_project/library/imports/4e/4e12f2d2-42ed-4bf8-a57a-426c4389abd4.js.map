{"version":3,"sources":["../../../../assets/scripts/assets/scripts/Game.js"],"names":["cc","Class","extends","Component","properties","pilotPrefab","default","type","Prefab","stonePrefab","player","Node","btnNode","finalTimeNode","instructionNode","scoreDisplay","Label","timeDisplay","scoreAudio","AudioClip","cryAudio","boomAudio","goal","onLoad","time","backPilot","leftPilot","nStone","enabled","resetValue","onStartGame","systemEvent","on","SystemEvent","EventType","KEY_UP","onKeyUp","string","active","x","spawnNewStone","event","keyCode","macro","KEY","space","spawnNewPilot","onDestroy","off","i","newStone","instantiate","setPosition","getStonePosition","getComponent","game","node","addChild","audioEngine","playEffect","newPilot","getNewPilotPosition","v2","y","height","update","dt","getChildByName","toFixed","gameOver","gainScore","childrenCount","children","destroy"],"mappings":"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","file":"Game.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        pilotPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        stonePrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        // 飞船\n        player: {\n            default: null,\n            type: cc.Node\n        },\n        btnNode: {\n            default: null,\n            type: cc.Node\n        },\n        finalTimeNode: {\n            default: null,\n            type: cc.Node\n        },\n        instructionNode: {\n            default: null,\n            type: cc.Node\n        },\n        // score label 的引用\n        scoreDisplay: {\n            default: null,\n            type: cc.Label\n        },\n        timeDisplay: {\n            default: null,\n            type: cc.Label\n        },\n        // 得分音效资源\n        scoreAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        cryAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        boomAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        goal: 5,\n    },\n\n    onLoad: function () {\n        // 初始化计分\n        this.time = 0;\n        this.backPilot = 0;\n        this.leftPilot = 10;\n        this.nStone = 20;\n        this.enabled = false;\n    },\n\n    resetValue: function (){\n        this.time = 0;\n        this.backPilot = 0;\n        this.leftPilot = 10;\n    },\n\n    onStartGame: function () {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n        this.resetValue();\n        this.scoreDisplay.string = 'Pilot: ' + this.backPilot + '/' + this.goal;\n        this.enabled = true;\n        this.finalTimeNode.active = false;\n        this.instructionNode.active = false;\n        this.btnNode.x = 3000;\n        this.spawnNewStone();\n    },\n\n    onKeyUp (event) {\n        // unset a flag when key released\n        switch(event.keyCode) {\n            case cc.macro.KEY.space:\n                this.spawnNewPilot();\n                break;\n        }\n    },\n    onDestroy () {\n        // 取消键盘输入监听\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n    },\n\n    spawnNewStone: function() { \n        for (var i = 0; i < this.nStone; i++) {\n            var newStone = cc.instantiate(this.stonePrefab);\n            newStone.setPosition(this.getStonePosition());           \n            newStone.getComponent(\"Stone\").game = this;\n            this.node.addChild(newStone);\n        }\n    },\n\n    spawnNewPilot: function() {\n        // 使用给定的模板在场景中生成一个新节点\n        cc.audioEngine.playEffect(this.cryAudio, false);\n        let newPilot = cc.instantiate(this.pilotPrefab);\n        // 将新增的节点添加到 Canvas 节点下面\n        this.node.addChild(newPilot);\n        // 为设置一个随机位置\n        newPilot.setPosition(this.getNewPilotPosition());\n        // 在组件上暂存 Game 对象的引用\n        newPilot.getComponent('Pilot').game = this;\n        this.leftPilot --;\n    },\n    getStonePosition() {\n        return cc.v2(this.player.x , this.player.y);\n    },\n    getNewPilotPosition () {\n        return cc.v2(this.player.x, this.player.y + this.player.height/2);\n    },\n\n    update: function (dt) {\n        this.time += dt;\n        this.node.getChildByName(\"time\").getComponent(cc.Label).string = 'Time: ' + this.time.toFixed(1) + 's';\n        if (this.backPilot == this.goal || this.leftPilot == 0) {\n            this.gameOver();\n        }\n    },\n\n    gainScore: function () {\n        this.backPilot++;\n        // 更新 scoreDisplay Label 的文字\n        this.scoreDisplay.string = 'Pilot: ' + this.backPilot + '/' + this.goal;\n        // 播放得分音效\n        cc.audioEngine.playEffect(this.scoreAudio, false);\n    },\n\n    gameOver: function () {\n        for (let i=0; i < this.node.childrenCount; i++){\n            if(this.node.children[i]['_name'] == 'stone' || this.node.children[i]['_name'] == 'star'){\n                this.node.children[i].destroy();\n            }                            \n        }\n        \n        this.btnNode.x = 0;\n        this.enabled = false;\n        this.finalTimeNode.active = true;\n        this.instructionNode.active = true;\n        if(this.leftPilot == 0){\n            this.finalTimeNode.getComponent(cc.Label).string = \"Mission failed.\"\n        }\n        if(this.backPilot == this.goal){\n            this.finalTimeNode.getComponent(cc.Label).string = \"Time used: \" + this.time.toFixed(1) + \"s\";\n        }\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n    }\n});\n"]}